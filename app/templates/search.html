{% extends "base.html" %}

{% block title %}Search Anime{% endblock %}

{% block content %}

<h2 style="margin-bottom:20px;">Search Anime üîç</h2>

<!-- SEARCH FORM -->
<form method="POST" action="{{ url_for('main_bp.search') }}"
      style="margin-bottom:40px; display:flex; gap:10px; max-width:500px;">

    <input type="text"
           name="anime_name"
           placeholder="Enter anime name..."
           required
           style="
                flex:1;
                padding:10px;
                border-radius:6px;
                border:none;
                outline:none;
           ">

    <button type="submit"
            style="
                padding:10px 18px;
                border:none;
                border-radius:6px;
                background:#ff4c4c;
                color:white;
                cursor:pointer;
           ">
        Search
    </button>
</form>


<!-- RESULTS SECTION -->
{% if results and results|length > 0 %}
    <div style="
        display:grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap:25px;
    ">

        {% for anime in results %}

        <div style="
            background:#1e1e1e;
            border-radius:12px;
            overflow:hidden;
            box-shadow:0 4px 10px rgba(0,0,0,0.5);
        ">

            <!-- IMAGE -->
            <a href="{{ url_for('main_bp.anime_detail', anime_id=anime.mal_id) }}">
    <img src="{{ anime.images.jpg.image_url }}"
         alt="{{ anime.title }}"
         style="width:100%; height:300px; object-fit:cover;">
</a>

            <div style="padding:15px;">

                <h3 style="font-size:16px; margin-bottom:8px;">
                    {{ anime.title }}
                </h3>

                <p style="color:gray; font-size:14px;">
                    ‚≠ê Score: {{ anime.score or "N/A" }}
                </p>

                <p style="color:gray; font-size:14px;">
                    üé¨ Episodes: {{ anime.episodes or "Unknown" }}
                </p>

                <p style="color:gray; font-size:14px; margin-bottom:10px;">
                    üì∫ Type: {{ anime.type }}
                </p>

                <!-- FAVORITES LOGIC -->
                {% if "user_id" in session %}

                    {% if anime.mal_id in favorite_ids %}

                        <button style="
                            width:100%;
                            padding:8px;
                            border:none;
                            background:#333;
                            color:#ff4c4c;
                            border-radius:6px;
                        ">
                            ‚ù§Ô∏è Already in Favorites
                        </button>

                    {% else %}

                        <form method="POST"
                              action="{{ url_for('fav_bp.add_favorite') }}">

                            <input type="hidden"
                                   name="anime_id"
                                   value="{{ anime.mal_id }}">

                            <input type="hidden"
                                   name="anime_title"
                                   value="{{ anime.title }}">

                            <input type="hidden"
                                   name="anime_image"
                                   value="{{ anime.images.jpg.image_url }}">

                            <button type="submit"
                                    style="
                                        width:100%;
                                        padding:8px;
                                        border:none;
                                        background:#ff4c4c;
                                        color:white;
                                        border-radius:6px;
                                        cursor:pointer;
                                    ">
                                ‚ù§Ô∏è Add to Favorites
                            </button>
                        </form>

                    {% endif %}

                {% else %}
                    <p style="color:gray; font-size:13px;">
                        Login to add favorites
                    </p>
                {% endif %}

            </div>

        </div>

        {% endfor %}
    </div>

{% elif request.method == "POST" %}
    <p>No results found.</p>
{% endif %}

{% endblock %}